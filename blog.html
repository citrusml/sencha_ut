---
layout: default
title: Blog
---

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<div class="container my-5">
  
  <div class="tag-container mb-4">
    <button class="tag-filter-btn active" onclick="filterBy('all')">All</button>
    {% for tag in site.tags %}
      {% assign tag_name = tag[0] %}
      <button class="tag-filter-btn" onclick="filterBy('{{ tag_name }}')">
        #{{ tag_name }}
      </button>
    {% endfor %}
  </div>

  <div class="blog-posts">
    {% for post in site.posts %}
      <div class="post-item" data-tags="{{ post.tags | join: ',' }}">
        
        {% if post.image %}
        <div class="post-thumbnail">
          <a href="{{ post.url | relative_url }}">
            <img src="{{ post.image | relative_url }}" alt="{{ post.title }}">
          </a>
        </div>
        {% endif %}

        <div class="post-content">
          <div class="post-meta">
            <span class="post-date">{{ post.date | date: "%Y/%m/%d" }}</span>
            <span class="post-tags-display">
              {% for tag in post.tags %} #{{ tag }} {% endfor %}
            </span>
          </div>

          <h3 class="post-title">
            <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
          </h3>
          
          <div class="post-excerpt">
            {{ post.excerpt | strip_html | truncate: 100 }}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <div id="pagination-controls" class="mt-5 text-center">
    <button id="prevBtn" class="btn btn-outline-secondary me-2" onclick="changePage(-1)">❮ Prev</button>
    <span id="pageIndicator" class="mx-3 text-muted">Page 1</span>
    <button id="nextBtn" class="btn btn-outline-secondary ms-2" onclick="changePage(1)">Next ❯</button>
  </div>

</div>

<style>
  /* タグボタン */
  .tag-container { display: flex; flex-wrap: wrap; gap: 8px; }
  .tag-filter-btn {
    background: #fff; border: 1px solid #ddd; border-radius: 20px;
    padding: 5px 15px; cursor: pointer; font-size: 0.9rem; color: #555;
    transition: all 0.2s;
  }
  .tag-filter-btn:hover, .tag-filter-btn.active {
    background: #333; color: #fff; border-color: #333;
  }

  /* 記事リスト */
  .post-item {
    display: flex; gap: 20px; padding: 25px 0; border-bottom: 1px solid #eee;
    align-items: flex-start;
  }
  
  /* サムネイル */
  .post-thumbnail { flex-shrink: 0; width: 180px; }
  .post-thumbnail img {
    width: 100%; height: 120px; object-fit: cover;
    border-radius: 8px; border: 1px solid #f0f0f0;
  }

  /* テキスト部分 */
  .post-content { flex-grow: 1; }
  .post-meta { font-size: 0.85rem; color: #888; margin-bottom: 5px; }
  .post-tags-display { margin-left: 10px; color: #007bff; font-weight: bold; }
  .post-title { margin: 5px 0 8px; font-size: 1.3rem; line-height: 1.4; }
  .post-title a { text-decoration: none; color: #333; }
  .post-excerpt { font-size: 0.95rem; color: #666; line-height: 1.6; }

  /* スマホ対応 */
  @media (max-width: 600px) {
    .post-item { flex-direction: column; }
    .post-thumbnail { width: 100%; }
    .post-thumbnail img { height: 180px; }
  }
</style>

<script>
  // 設定
  const itemsPerPage = 10; // 1ページあたりの件数
  let currentPage = 1;
  let currentFilteredPosts = []; // 現在表示対象となっている記事リスト

  // 初期化：ページ読み込み時
  document.addEventListener("DOMContentLoaded", function() {
    // すべての記事要素を取得して配列にする
    const allPosts = Array.from(document.getElementsByClassName('post-item'));
    currentFilteredPosts = allPosts; // 最初は全記事が対象
    renderPage(); // 描画
  });

  // 1. フィルタリング機能
  function filterBy(tagName) {
    const allPosts = Array.from(document.getElementsByClassName('post-item'));
    const buttons = document.getElementsByClassName('tag-filter-btn');

    // ボタンの色切替
    for (let btn of buttons) {
      btn.classList.remove('active');
      if (tagName === 'all' && btn.innerText === 'All') btn.classList.add('active');
      else if (btn.innerText.includes(tagName)) btn.classList.add('active');
    }

    // 記事の絞り込みリストを作成
    if (tagName === 'all') {
      currentFilteredPosts = allPosts;
    } else {
      currentFilteredPosts = allPosts.filter(post => {
        const postTags = post.getAttribute('data-tags').split(',');
        return postTags.includes(tagName);
      });
    }

    // フィルターを変えたらページを1に戻して再描画
    currentPage = 1;
    renderPage();
  }

  // 2. ページ切り替え機能
  function changePage(direction) {
    const maxPage = Math.ceil(currentFilteredPosts.length / itemsPerPage);
    const nextPage = currentPage + direction;

    if (nextPage >= 1 && nextPage <= maxPage) {
      currentPage = nextPage;
      renderPage();
      // ページ上部へスクロール（お好みで）
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  }

  // 3. 描画実行機能
  function renderPage() {
    const allPosts = Array.from(document.getElementsByClassName('post-item'));
    
    // まず全記事を非表示にする
    allPosts.forEach(post => post.style.display = 'none');

    // 現在のページの範囲を計算 (例: 1ページ目なら 0〜9)
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    
    // 対象の記事だけを表示させる
    const postsToShow = currentFilteredPosts.slice(startIndex, endIndex);
    postsToShow.forEach(post => {
      post.style.display = 'flex'; // CSSに合わせてflexで表示
    });

    updatePaginationControls();
  }

  // 4. ボタンの状態更新
  function updatePaginationControls() {
    const maxPage = Math.ceil(currentFilteredPosts.length / itemsPerPage);
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const indicator = document.getElementById('pageIndicator');

    // 0件のときの処理
    if (maxPage === 0) {
        prevBtn.disabled = true;
        nextBtn.disabled = true;
        indicator.innerText = "No posts found";
        return;
    }

    // ページ番号表示
    indicator.innerText = `Page ${currentPage} / ${maxPage}`;

    // ボタンの有効/無効化
    prevBtn.disabled = (currentPage === 1);
    nextBtn.disabled = (currentPage === maxPage);
  }
</script>